<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>umbra_v1.0.2.exe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f4f4;
            --text-color: #1a1a1a;
            --accent-color: #3b82f6;
            --border-color: #d1d5db;
            --umbra-shadow: rgba(0, 0, 0, 0.1);
        }

        .dark-mode {
            --bg-color: #0a0a0c;
            --text-color: #a0a0a8;
            --accent-color: #818cf8;
            --border-color: #27272a;
            --umbra-shadow: rgba(255, 255, 255, 0.03);
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s ease;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Paper Grain */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.015;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            z-index: 100;
        }

        .cursor-blink {
            display: inline-block;
            width: 9px;
            height: 1.2em;
            background-color: var(--text-color);
            vertical-align: middle;
            animation: blink 1.2s step-end infinite;
        }

        @keyframes blink { from, to { opacity: 1; } 50% { opacity: 0; } }

        .txt-border { border: 1px dashed var(--border-color); }
        .txt-border-solid { border: 1px solid var(--border-color); }

        .hover-reveal {
            transition: all 0.2s ease;
        }
        .hover-reveal:hover {
            background: var(--text-color);
            color: var(--bg-color);
            transform: translateY(-1px);
        }

        .umbra-title {
            transition: text-shadow 0.5s ease, transform 0.3s ease;
        }
        .umbra-title:hover {
            text-shadow: 8px 8px 0px var(--umbra-shadow);
            transform: translate(-2px, -2px);
        }

        .view-transition {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scanline effect */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%);
            background-size: 100% 4px;
            z-index: 99;
            pointer-events: none;
            opacity: 0.08;
        }

        input {
            background: transparent;
            border: none;
            outline: none;
            color: inherit;
            font-family: inherit;
            width: 100%;
        }

        .active-tab {
            background: var(--text-color);
            color: var(--bg-color);
            border-style: solid;
        }

        /* Prose styling for markdown */
        .prose {
            line-height: 1.7;
        }
        .prose h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 1.5rem 0 1rem 0;
            text-transform: uppercase;
        }
        .prose h2 {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 1.2rem 0 0.8rem 0;
        }
        .prose p {
            margin: 0.8rem 0;
        }
        .prose ul, .prose ol {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
        }
        .prose blockquote {
            border-left: 3px solid var(--border-color);
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            opacity: 0.8;
        }
    </style>
</head>
<body class="dark-mode p-4 md:p-12 min-h-screen flex flex-col">
    <div class="scanlines"></div>

    <!-- Top UI Bar -->
    <header class="max-w-4xl mx-auto w-full mb-12">
        <div class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-3xl font-medium umbra-title cursor-default tracking-tighter">
                    UMBRA<span class="cursor-blink ml-1"></span>
                </h1>
                <div class="text-[10px] opacity-40 mt-1 uppercase tracking-widest">
                    Kernel: 1.0.2-stable // session_id: <span id="session-id">...</span>
                </div>
            </div>

            <div class="flex flex-col items-end gap-2">
                <div id="live-clock" class="text-xs font-bold">00:00:00</div>
                <button onclick="toggleTheme()" class="text-[9px] txt-border px-2 py-1 hover-reveal uppercase tracking-tighter">
                    [ Switch_Mode ]
                </button>
            </div>
        </div>

        <nav class="flex flex-wrap gap-2 text-xs">
            <button onclick="switchView('manifest')" id="tab-manifest" class="nav-tab txt-border px-4 py-2 hover-reveal active-tab">01.PROTOCOL</button>
            <button onclick="switchView('logs')" id="tab-logs" class="nav-tab px-4 py-2 txt-border hover-reveal">02.LOGS</button>
            <button onclick="switchView('archive')" id="tab-archive" class="nav-tab txt-border px-4 py-2 hover-reveal">03.ARCHIVE</button>
            <button onclick="switchView('terminal')" id="tab-terminal" class="nav-tab px-4 py-2 txt-border hover-reveal">04.QUERY</button>
        </nav>
    </header>

    <!-- Main Dynamic Canvas -->
    <main id="main-content" class="max-w-4xl mx-auto w-full flex-grow view-transition">
        <!-- Content injected here via JS -->
    </main>

    <!-- Footer Stats -->
    <footer class="max-w-4xl mx-auto w-full mt-16 pt-6 border-t border-dashed border-gray-800/30">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-[10px] opacity-50 mb-8">
            <div>
                <div class="mb-1">STORAGE_USED</div>
                <div class="w-full bg-gray-800 h-1">
                    <div class="bg-current h-full" style="width: 14%"></div>
                </div>
            </div>
            <div>
                <div class="mb-1">UPLINK</div>
                <div>SECURE_ENCRYPTED</div>
            </div>
            <div>
                <div class="mb-1">COORD</div>
                <div id="mouse-coord">0.0, 0.0</div>
            </div>
            <div class="text-right">
                <div class="mb-1">VER</div>
                <div>BUILD_2026_JAN</div>
            </div>
        </div>

        <div id="system-tray" class="text-[10px] font-mono flex justify-between items-center opacity-40">
            <span id="last-event">SYSTEM_IDLE</span>
            <span>UTF-8 // LNX-09</span>
        </div>
    </footer>

    <script>
        // --- State Management ---
        let currentView = 'manifest';
        let postsData = [];
        let manifestContent = '';
        const sessionId = Math.random().toString(16).slice(2, 10).toUpperCase();
        document.getElementById('session-id').textContent = sessionId;

        // --- Load Content ---
        async function loadPosts() {
            try {
                const response = await fetch('content/posts.json?v=' + Date.now());
                postsData = await response.json();
                postsData.sort((a, b) => new Date(b.date) - new Date(a.date)); // Latest first
            } catch (error) {
                console.error('Failed to load posts:', error);
                postsData = [];
            }
        }

        async function loadManifest() {
            try {
                const response = await fetch('content/protocol.md?v=' + Date.now());
                const markdown = await response.text();
                manifestContent = marked.parse(markdown);
            } catch (error) {
                manifestContent = '<p>Protocol content unavailable.</p>';
            }
        }

        async function loadPost(filename) {
            try {
                const response = await fetch(`content/posts/${filename}?v=` + Date.now());
                const markdown = await response.text();
                return marked.parse(markdown);
            } catch (error) {
                return '<p>Post content unavailable.</p>';
            }
        }

        // --- View Templates ---
        const views = {
            manifest: () => `
                <section class="view-transition">
                    <div class="mb-4 text-xs opacity-30">/root/protocol.txt</div>
                    <div class="prose prose-invert max-w-none">
                        ${manifestContent}
                    </div>
                </section>
            `,
            archive: () => `
                <section class="view-transition">
                    <div class="mb-4 text-xs opacity-30">/root/archive/</div>
                    <h2 class="text-xl mb-6 font-bold uppercase tracking-widest">> Post Archive</h2>
                    <div class="space-y-4">
                        ${postsData.length > 0 ? postsData.map(post => `
                            <div class="p-4 txt-border hover:border-solid cursor-pointer group flex justify-between items-center" onclick="viewPost('${post.file}', '${post.title}')">
                                <div>
                                    <div class="text-sm font-bold">${post.title}</div>
                                    <div class="text-[10px] opacity-40">
                                        DATE: ${post.date} // TIME: ${post.timestamp || '00:00:00'}
                                        ${post.tags ? '// TAGS: ' + post.tags.join(', ').toUpperCase() : ''}
                                    </div>
                                </div>
                                <span class="text-[10px] opacity-0 group-hover:opacity-100 transition-opacity">-- READ --</span>
                            </div>
                        `).join('') : '<div class="text-sm opacity-40">No posts archived yet.</div>'}
                    </div>
                </section>
            `,
            logs: () => `
                <section class="view-transition">
                    <div class="mb-4 text-xs opacity-30">/var/logs/posts.log</div>
                    <h2 class="text-xl mb-6 font-bold uppercase tracking-widest">> Recent Posts</h2>
                    <div class="space-y-6">
                        ${postsData.length > 0 ? postsData.map(post => `
                            <div class="pb-6 border-b border-dashed border-gray-800/30 last:border-0 cursor-pointer group" onclick="viewPost('${post.file}', '${post.title}')">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="text-sm font-bold group-hover:opacity-60 transition-opacity">${post.title}</div>
                                    <div class="text-[10px] opacity-40">${post.date}</div>
                                </div>
                                <div class="text-sm opacity-70 leading-relaxed">
                                    ${post.excerpt || 'No excerpt available.'}
                                </div>
                                <div class="text-[10px] opacity-0 group-hover:opacity-100 transition-opacity mt-2">
                                    READ MORE â†’
                                </div>
                            </div>
                        `).join('') : '<div class="text-sm opacity-40">No posts logged yet.</div>'}
                    </div>
                </section>
            `,
            terminal: () => `
                <section class="view-transition">
                    <div class="mb-4 text-xs opacity-30">/root/query</div>
                    <h2 class="text-xl mb-6 font-bold uppercase tracking-widest">> Query Interface</h2>
                    <div id="terminal-output" class="font-mono text-xs mb-4 h-48 overflow-y-auto opacity-80 leading-loose">
                        <div>Umbra Query Interface v1.0.2</div>
                        <div>Type 'help' for available commands.</div>
                    </div>
                    <div class="flex items-center gap-2 font-mono text-xs p-2 txt-border">
                        <span class="text-blue-500">guest@umbra:~$</span>
                        <input type="text" id="terminal-input" autofocus onkeydown="handleCommand(event)">
                    </div>
                </section>
            `
        };

        /* ===== SAVED: Event Stream Functionality (for potential future use) =====
        const logs = [
            `[${new Date().toLocaleTimeString()}] KERNEL_INIT: OK`,
            `[${new Date().toLocaleTimeString()}] AUTH_GUEST: SUCCESS`,
            `[${new Date().toLocaleTimeString()}] UI_RENDER: COMPLETE`
        ];

        function updateLogsWithPosts() {
            postsData.slice(0, 5).forEach(post => {
                logs.push(`[${post.timestamp || '00:00:00'}] POST_ARCHIVED: ${post.title}`);
            });
        }

        function updateStatus(msg) {
            const time = new Date().toLocaleTimeString();
            logs.unshift(`[${time}] ${msg}`);
            document.getElementById('last-event').textContent = `EVENT: ${msg}`;
        }
        ===== END SAVED CODE ===== */

        // --- Core Functions ---
        function switchView(viewName) {
            currentView = viewName;
            document.getElementById('main-content').innerHTML = views[viewName]();

            // Update tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(`tab-${viewName}`).classList.add('active-tab');

            if (viewName === 'terminal') {
                setTimeout(() => document.getElementById('terminal-input')?.focus(), 100);
            }
            updateStatus(`View Switched: ${viewName.toUpperCase()}`);
        }

        async function viewPost(filename, title) {
            const content = await loadPost(filename);
            document.getElementById('main-content').innerHTML = `
                <section class="view-transition">
                    <div class="mb-4 text-xs opacity-30">/root/archive/${filename}</div>
                    <button onclick="switchView('archive')" class="text-xs txt-border px-3 py-1 hover-reveal mb-6">
                        &larr; BACK TO ARCHIVE
                    </button>
                    <div class="prose prose-invert max-w-none">
                        ${content}
                    </div>
                </section>
            `;
            updateStatus(`Post Opened: ${title}`);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            updateStatus('Theme Toggled');
        }

        function updateStatus(msg) {
            document.getElementById('last-event').textContent = `EVENT: ${msg}`;
        }

        // --- Terminal Logic ---
        function handleCommand(e) {
            if (e.key === 'Enter') {
                const input = e.target;
                const cmd = input.value.toLowerCase().trim();
                const output = document.getElementById('terminal-output');

                const response = document.createElement('div');
                response.innerHTML = `<span class="opacity-40">guest@umbra:~$</span> ${cmd}`;
                output.appendChild(response);

                const result = document.createElement('div');
                switch(cmd) {
                    case 'help':
                        result.textContent = "Available: help, clear, date, whoami, version, theme, posts";
                        break;
                    case 'whoami':
                        result.textContent = "You are a guest in the Umbra Archive.";
                        break;
                    case 'date':
                        result.textContent = new Date().toString();
                        break;
                    case 'version':
                        result.textContent = "Umbra OS v1.0.2. Build: 2026.01.16";
                        break;
                    case 'theme':
                        toggleTheme();
                        result.textContent = "Toggling visual density...";
                        break;
                    case 'posts':
                        result.textContent = `${postsData.length} posts archived. Use 'archive' view to read.`;
                        break;
                    case 'clear':
                        output.innerHTML = '';
                        break;
                    default:
                        result.textContent = `Command not found: ${cmd}`;
                        break;
                }
                output.appendChild(result);
                input.value = '';
                output.scrollTop = output.scrollHeight;
                updateStatus(`Command Exec: ${cmd}`);
            }
        }

        // --- Utilities ---
        function updateClock() {
            document.getElementById('live-clock').textContent = new Date().toLocaleTimeString('en-GB');
        }

        window.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth).toFixed(2);
            const y = (e.clientY / window.innerHeight).toFixed(2);
            document.getElementById('mouse-coord').textContent = `${x}, ${y}`;
        });

        setInterval(updateClock, 1000);

        // Initialize
        window.onload = async () => {
            await loadPosts();
            await loadManifest();
            switchView('manifest');
        };
    </script>
</body>
</html>
